<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Проекты</title>
    <link rel="stylesheet" href="../css/index.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Sharp" rel="stylesheet">
    <script src="/js/js.cookie.js"></script>
</head>
<body>
<div class="container">
    {{template "aside.html"}}
    <main>
        <h1>Проекты</h1>
        <div class="date">
            <input type="date">
        </div>

        <div class="insights">
            {{ range $projects := .projects }}
            <div class="sales">
                <span hidden>{{ .ID }}</span>
                <h1>{{ .Name }}</h1>
                <h3>{{ .Description }}</h3>
<!--                <span class="material-icons-sharp">analytics</span>-->
                <div class="middle">
                    <div class="left">
                        <h3>Всего задач</h3>
                        <h1>{{ .IssuesCnt }}</h1>
                    </div>
                </div>
                <small class="text-muted updated">{{ .Updated }}</small>
            </div>
            {{ end }}
        </div>
        <!------------------ END OF INSIGTS ------------------>
    </main>
    <div class="right">
        {{ template "right-top.html" .}}
        {{ template "resent-updates.html" }}
        <!-------------------- END OF RECENT UPDATES -------------------->
        <div class="sales-analytics">
            <div class="item add-product">
                <div>
                    <span class="material-icons-sharp">add</span>
                    <h3>Добавить проект</h3>
                </div>
            </div>
        </div>
    </div>

</div>
<script src="/js/aside.js"></script>
<script src="/js/right-top.js"></script>
<script>
    const addProductBtn = document.querySelector(".add-product")

    addProductBtn.addEventListener('click', () => {
        location.assign("/project/create");
    })

    const insights = document.querySelector(".insights");
    insights.addEventListener('click', (event) => {
        let sales = event.target.closest('.sales');

        if (sales.className === 'sales') {
            location.assign("/project/"+sales.childNodes[1].innerHTML);
        }
    })

    addEventListener("load", () => {
        let containers = document.getElementsByClassName('updated')
        for (let i = 0; i < containers.length; i++) {
            let second = containers[i].innerHTML
            let finalStr = 'Последние '
            let month = Math.floor(second/60/60/24/30)
            let day = Math.floor(second/60/60/24) - (month * 30)
            let hour = Math.floor(second/60/60) - (day * 24)
            let minute = Math.floor(second/60) - (day * 24 * 60 + hour*60)
            second = second - (day * 24 * 60 * 60 + hour * 60 * 60 + minute * 60)
            if (day > 0) {
                finalStr += day + ' д. '
            }
            if (hour > 0) {
                finalStr += hour + ' ч. '
            }
            if (minute > 0) {
                finalStr += minute + ' мин. '
            }
            if (second > 0) {
                finalStr += second + ' сек.'
            }
            if (month > 0) {
                finalStr = 'Более ' + month + ' мес.'
            }
            containers[i].innerHTML = finalStr
        }
    })

</script>
</body>
</html>